# ОТКАТ к рабочему варианту (без ProxyFix)
# Применить на сервере если ProxyFix не работает

# ========================================
# ФАЙЛ: src/web/web_admin.py
# ========================================

# СТРОКА 46 - изменить:
# БЫЛО:
static_url_path='/static')  # БЕЗ BASE_PATH!

# СТАЛО:
static_url_path=f"{BASE_PATH}/static")  # С BASE_PATH (откат)


# СТРОКИ 48-56 - закомментировать ProxyFix:
# БЫЛО:
app.wsgi_app = ProxyFix(
    app.wsgi_app,
    x_for=1,
    x_proto=1,
    x_host=1,
    x_prefix=1
)

# СТАЛО (закомментировать):
# ProxyFix не работает с nginx trailing slash, откатываемся
# app.wsgi_app = ProxyFix(
#     app.wsgi_app,
#     x_for=1,
#     x_proto=1,
#     x_host=1,
#     x_prefix=1
# )


# ========================================
# NGINX конфигурация
# ========================================

# ВЕРНУТЬ trailing slash в proxy_pass:

location /faqbot/ {
    proxy_pass http://faqbot-web-admin:5000/;  # С trailing slash!
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_http_version 1.1;
    proxy_buffering off;
}

# X-Script-Name можно убрать (не используется без ProxyFix)
