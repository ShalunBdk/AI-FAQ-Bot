services:
  # PostgreSQL - база данных для Strapi
  postgres:
    image: postgres:15-alpine
    container_name: faq_postgres
    restart: unless-stopped
    environment:
      POSTGRES_DB: strapi
      POSTGRES_USER: strapi
      POSTGRES_PASSWORD: strapi_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - faq_network
    ports:
      - "5432:5432"

  # Strapi - CMS для управления FAQ
  strapi:
    image: strapi:latest
    container_name: faq_strapi
    restart: unless-stopped
    environment:
      DATABASE_CLIENT: postgres
      DATABASE_HOST: postgres
      DATABASE_PORT: 5432
      DATABASE_NAME: strapi
      DATABASE_USERNAME: strapi
      DATABASE_PASSWORD: strapi_password
      JWT_SECRET: 679e1efc2dc0d5562f56ec85c108e55a45f5a43752209f805a5d22976dff4c2d
      ADMIN_JWT_SECRET: 8287af572c957eea80dd70e376ac06e0e6f41d51cba4a29368b99b247cec752c
      APP_KEYS: a106a574735040988bd81dfac428690b
      API_TOKEN_SALT: 382cf96d7252565c0e25452658b6af6c
    volumes:
      - strapi_data:/srv/app
    networks:
      - faq_network
    ports:
      - "1337:1337"
    depends_on:
      - postgres

  # Qdrant - векторная база данных
  qdrant:
    image: qdrant/qdrant:latest
    container_name: faq_qdrant
    restart: unless-stopped
    volumes:
      - qdrant_data:/qdrant/storage
    networks:
      - faq_network
    ports:
      - "6333:6333"
      - "6334:6334"

  # FastAPI Backend (нужно создать Dockerfile)
  # Закомментирован, т.к. требует создания отдельного Dockerfile
  # backend:
  #   build: ./backend
  #   container_name: faq_backend
  #   restart: unless-stopped
  #   environment:
  #     QDRANT_HOST: qdrant
  #     QDRANT_PORT: 6333
  #     STRAPI_URL: http://strapi:1337
  #     TELEGRAM_TOKEN: ${TELEGRAM_TOKEN}
  #   networks:
  #     - faq_network
  #   ports:
  #     - "8000:8000"
  #   depends_on:
  #     - qdrant
  #     - strapi

volumes:
  postgres_data:
  strapi_data:
  qdrant_data:

networks:
  faq_network:
    driver: bridge