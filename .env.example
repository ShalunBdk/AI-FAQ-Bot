# Пример конфигурации FAQ Бота
# Скопируйте этот файл в .env и заполните значения
# cp .env.example .env

# ===============================================
# TELEGRAM BOT
# ===============================================
# Получить у @BotFather в Telegram
TELEGRAM_TOKEN=your_telegram_bot_token_here

# ===============================================
# ВЕКТОРНАЯ МОДЕЛЬ
# ===============================================
# Название модели из HuggingFace
# По умолчанию: paraphrase-multilingual-MiniLM-L12-v2
MODEL_NAME=paraphrase-multilingual-MiniLM-L12-v2

# Порог схожести для показа ответа пользователю (в процентах, 0-100)
# Если схожесть ниже этого порога, бот скажет что не нашел ответ
# Рекомендуемые значения:
#   - 30-40: Более мягкий порог, больше ответов (может быть менее точным)
#   - 45-50: Сбалансированный порог (рекомендуется)
#   - 60-70: Строгий порог, только точные совпадения
# По умолчанию: 45
SIMILARITY_THRESHOLD=45

# ===============================================
# RAG (LLM-ГЕНЕРАЦИЯ ОТВЕТОВ)
# ===============================================
# Включить/выключить RAG генерацию ответов через LLM
# true - бот будет генерировать ответы на основе FAQ
# false - бот будет возвращать точные ответы из FAQ
RAG_ENABLED=true

# API ключ для OpenRouter (обязателен если RAG_ENABLED=true)
# Получить: https://openrouter.ai/keys
# Стоимость: ~$0.15 за 1M токенов для gpt-4o-mini
OPENROUTER_API_KEY=your_openrouter_api_key_here

# Модель LLM для генерации (рекомендуется для русского языка)
# Доступные модели: https://openrouter.ai/models
# Рекомендации:
#   - openai/gpt-4o-mini: быстрая, дешевая, хорошо для русского (~$0.15/1M токенов)
#   - openai/gpt-4o: более качественная, дороже (~$2.50/1M токенов)
#   - anthropic/claude-3-haiku: альтернатива, быстрая (~$0.25/1M токенов)
OPENROUTER_MODEL=openai/gpt-4o-mini

# Максимум токенов в генерируемом ответе
# Больше = более длинные ответы, но дороже
# Рекомендуемые значения:
#   - 512: короткие ответы
#   - 1024: средние ответы (рекомендуется)
#   - 2048: длинные подробные ответы
RAG_MAX_TOKENS=1024

# Temperature для генерации (креативность)
# 0.0 = детерминированные ответы
# 1.0 = очень креативные ответы
# Рекомендуемые значения:
#   - 0.1-0.3: строгие, фактические ответы (рекомендуется для FAQ)
#   - 0.5-0.7: более естественные ответы
RAG_TEMPERATURE=0.3

# Минимальный порог релевантности для включения RAG (в процентах, 0-100)
# RAG включится только если найденный FAQ имеет confidence >= этого значения
# Рекомендуется использовать то же значение, что SIMILARITY_THRESHOLD
RAG_MIN_RELEVANCE_SCORE=45.0

# Максимум FAQ chunks для контекста LLM
# Больше = более полный контекст, но дороже и медленнее
# Рекомендуемые значения:
#   - 3: быстро, дешево
#   - 5: сбалансированно (рекомендуется)
#   - 10: максимум контекста
RAG_MAX_CHUNKS=5

# ===============================================
# БАЗА ДАННЫХ (для production)
# ===============================================
# PostgreSQL
DATABASE_URL=postgresql://user:password@localhost:5432/faq_bot
DB_HOST=localhost
DB_PORT=5432
DB_NAME=faq_bot
DB_USER=faq_user
DB_PASSWORD=strong_password_here

# ===============================================
# QDRANT (векторная БД для production)
# ===============================================
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_COLLECTION=faq_collection

# ===============================================
# STRAPI CMS (для production)
# ===============================================
STRAPI_URL=http://localhost:1337
STRAPI_API_TOKEN=your_strapi_api_token

# ===============================================
# БИТРИКС24 BOT
# ===============================================
# Вебхук для входящих/исходящих запросов в Bitrix24
# Получить: Настройки → Разработчикам → Вебхуки → Создать вебхук
# Требуемые права: im (чат-боты), user (пользователи)
BITRIX24_WEBHOOK=https://your-domain.bitrix24.ru/rest/1/webhook_key/

# Код бота (уникальный идентификатор в вашем приложении)
# Например: FAQBot
BITRIX24_BOT_CODE=FAQBot

# BOT_ID бота - ЧИСЛОВОЙ идентификатор (например: 62)
# ВАЖНО: BOT_ID и CLIENT_ID - это разные вещи!
#   - BOT_ID (число): используется для регистрации команд и событий
#   - CLIENT_ID (строка): используется для авторизации отправки сообщений
# Получить BOT_ID:
#   1. Запустите: python register_bot.py (если бот еще не зарегистрирован)
#   2. Или найдите в Bitrix24: Настройки → Разработчикам → Чат-боты
# Например: 62
BITRIX24_BOT_ID=62

# CLIENT_ID бота - строковый идентификатор для API запросов
# Получить: после регистрации бота через register_bot.py
# Или в настройках бота в Bitrix24
# Например: vntu29my52f21kbrx5jzjzctktvgvnbi
BITRIX24_CLIENT_ID=vntu29my52f21kbrx5jzjzctktvgvnbi

# Внешний URL обработчика событий (для регистрации команд)
# Это публичный URL, доступный из интернета
# Например: https://your-domain.com/webhook/bitrix24
# Или через туннель: https://abc123.ngrok.io/webhook/bitrix24
BITRIX24_HANDLER_URL=https://your-domain.com/webhook/bitrix24

# Имя бота (будет отображаться в чатах)
BITRIX24_BOT_NAME=FAQ Помощник

# Порт для приема вебхуков от Bitrix24 (по умолчанию 5002)
BITRIX24_PORT=5002

# Хост для сервера (0.0.0.0 = слушать на всех интерфейсах)
BITRIX24_HOST=0.0.0.0

# ===============================================
# БИТРИКС24 АДМИН-ПАНЕЛЬ (OAuth 2.0 интеграция)
# ===============================================
# Для встраивания веб-админки в Битрикс24 как приложение

# Client ID приложения Битрикс24 (для OAuth)
# Получить: Приложения → Разработчикам → Другое → Добавить приложение
# После создания локального приложения скопировать CLIENT_ID
# Например: local.5c8bb1b0891cf2.87252039
BITRIX24_CLIENT_ID=local.xxxxxxxxxx.xxxxxxxx

# Client Secret приложения Битрикс24 (для OAuth)
# Получить: в настройках созданного приложения
# Например: SakeVG5mbRdcQet45UUrt6q72AMTo7fkwXSO7Y5LYFYNCRsA6f
BITRIX24_CLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxx

# URL для OAuth callback (публичный HTTPS адрес)
# Указать в настройках приложения Битрикс24
# Например: https://your-domain.com/bitrix24/callback
BITRIX24_REDIRECT_URI=https://your-domain.com/bitrix24/callback

# URL админ-панели (публичный HTTPS адрес)
# Указать в настройках приложения как "URL встраивания приложения"
# Например: https://your-domain.com/bitrix24/app
BITRIX24_ADMIN_URL=https://your-domain.com/bitrix24/app

# Домен вашего портала Битрикс24 (для CORS)
# Примеры:
#   - Облачный: company.bitrix24.ru
#   - Корпоративный: bitrix.mycompany.com
#   - Самописный: portal.internal.local
# ВАЖНО: указывать БЕЗ https://, только домен
BITRIX24_DOMAIN=company.bitrix24.ru

# Дополнительные разрешенные домены для CORS (через запятую, опционально)
# Полезно для тестирования или мультипортальности
# Например: https://test.bitrix24.ru,https://dev.bitrix24.com
ALLOWED_ORIGINS=

# ===============================================
# FASTAPI (для production)
# ===============================================
API_HOST=0.0.0.0
API_PORT=8000
API_DEBUG=false

# Секретный ключ для JWT (основной)
SECRET_KEY=your_secret_key_change_me_in_production

# JWT секрет для access токенов (используется в админ-панели)
# Генерировать: openssl rand -hex 32
JWT_SECRET=your_super_secret_jwt_key_here

# JWT секрет для refresh токенов
# Генерировать: openssl rand -hex 32
REFRESH_SECRET=your_super_secret_refresh_key_here

# ===============================================
# ЛОГИРОВАНИЕ
# ===============================================
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR
LOG_FILE=logs/bot.log

# ===============================================
# ПРОЧЕЕ
# ===============================================
# Язык по умолчанию
DEFAULT_LANGUAGE=ru

# Таймзона
TIMEZONE=Europe/Moscow

# Окружение
ENVIRONMENT=development  # development, staging, production

# ===============================================
# REVERSE PROXY (для production)
# ===============================================
# Префикс пути для reverse proxy (например, если приложение доступно по /faqbot)
# Оставьте пустым если приложение на корневом пути
# ВАЖНО: Этот префикс автоматически добавится к BITRIX24_HANDLER_URL
# Пример:
#   BASE_PATH=/faqbot
#   BITRIX24_HANDLER_URL=https://domain.com/webhook/bitrix24
#   → Команды зарегистрируются с URL: https://domain.com/faqbot/webhook/bitrix24
BASE_PATH=
