# üåê –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è DMZ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ç–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          INTERNET                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ HTTPS (443)
                         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         FIREWALL                                ‚îÇ
‚îÇ                    (203.0.113.1)                                ‚îÇ
‚îÇ  Rules:                                                         ‚îÇ
‚îÇ  - Allow: 0.0.0.0/0 ‚Üí 203.0.113.10:443 (HTTPS)                 ‚îÇ
‚îÇ  - Allow: 0.0.0.0/0 ‚Üí 203.0.113.10:80 (HTTP redirect)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      DMZ ZONE                                   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ  Nginx Proxy Server                             ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  IP: 203.0.113.10 (external)                    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ      10.0.0.10 (internal DMZ)                   ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ                                                  ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç:                                    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  - admin.company.com ‚Üí 10.0.1.50:5000           ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  - bot.company.com   ‚Üí 10.0.1.50:5002           ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                           ‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ Internal network
                            ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    INTERNAL FIREWALL                            ‚îÇ
‚îÇ  Rules:                                                         ‚îÇ
‚îÇ  - Allow: 10.0.0.10 ‚Üí 10.0.1.50:5000 (Web Admin)               ‚îÇ
‚îÇ  - Allow: 10.0.0.10 ‚Üí 10.0.1.50:5002 (Bitrix24 Bot)            ‚îÇ
‚îÇ  - Deny: all other from DMZ                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   INTERNAL NETWORK                              ‚îÇ
‚îÇ                   (10.0.1.0/24)                                 ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ  Docker Host Server                             ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  IP: 10.0.1.50                                  ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ                                                  ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  web-admin     ‚îÇ  ‚îÇ bitrix24-bot   ‚îÇ        ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  :5000         ‚îÇ  ‚îÇ :5002          ‚îÇ        ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ           ‚îÇ                   ‚îÇ                 ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ                       ‚îÇ                         ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ            ‚îÇ  Shared Storage     ‚îÇ              ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ            ‚îÇ  - faq_database.db  ‚îÇ              ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ            ‚îÇ  - chroma_db/       ‚îÇ              ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. Nginx —Å–µ—Ä–≤–µ—Ä –≤ DMZ (203.0.113.10 / 10.0.0.10)

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ù–∞ Nginx —Å–µ—Ä–≤–µ—Ä–µ –≤ DMZ
cd /etc/nginx/sites-available/

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
scp user@build-server:/path/to/FAQBot/nginx/external-nginx.conf ./faqbot

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ IP –∞–¥—Ä–µ—Å–∞
nano faqbot

# –ù–∞–π–¥–∏—Ç–µ –∏ –∑–∞–º–µ–Ω–∏—Ç–µ:
# upstream faqbot_admin {
#     server 10.0.1.50:5000;  # ‚Üê –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π IP Docker —Ö–æ—Å—Ç–∞
# }
#
# upstream faqbot_bitrix {
#     server 10.0.1.50:5002;  # ‚Üê –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π IP Docker —Ö–æ—Å—Ç–∞
# }

# –°–æ–∑–¥–∞–π—Ç–µ —Å–∏–º–ª–∏–Ω–∫
ln -s /etc/nginx/sites-available/faqbot /etc/nginx/sites-enabled/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Nginx
systemctl reload nginx
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ DMZ

```bash
# –ù–∞ Nginx —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Docker —Ö–æ—Å—Ç–∞
telnet 10.0.1.50 5000
# –î–æ–ª–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

telnet 10.0.1.50 5002
# –î–æ–ª–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
curl http://10.0.1.50:5000/health
curl http://10.0.1.50:5002/health
```

### 2. Docker —Ö–æ—Å—Ç —Å–µ—Ä–≤–µ—Ä (10.0.1.50)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä—Ç–æ–≤ –≤ docker-compose

–ü–æ—Ä—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö:

```yaml
# docker-compose.yml —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
services:
  web-admin:
    ports:
      - "5000:5000"  # –ë–∏–Ω–¥–∏—Ç—Å—è –Ω–∞ 0.0.0.0:5000

  bitrix24-bot:
    ports:
      - "5002:5002"  # –ë–∏–Ω–¥–∏—Ç—Å—è –Ω–∞ 0.0.0.0:5002
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall –Ω–∞ Docker —Ö–æ—Å—Ç–µ

```bash
# –ù–∞ Docker —Ö–æ—Å—Ç–µ (10.0.1.50)

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç—ã —Å–ª—É—à–∞—é—Ç—Å—è
ss -tlnp | grep -E ':(5000|5002)'
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# 0.0.0.0:5000  LISTEN
# 0.0.0.0:5002  LISTEN

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ ufw:
sudo ufw allow from 10.0.0.10 to any port 5000 proto tcp comment 'Nginx DMZ ‚Üí Web Admin'
sudo ufw allow from 10.0.0.10 to any port 5002 proto tcp comment 'Nginx DMZ ‚Üí Bitrix24'

# –ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ firewalld:
sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="10.0.0.10" port port="5000" protocol="tcp" accept'
sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="10.0.0.10" port port="5002" protocol="tcp" accept'
sudo firewall-cmd --reload

# –ò–ª–∏ iptables:
sudo iptables -A INPUT -s 10.0.0.10 -p tcp --dport 5000 -j ACCEPT
sudo iptables -A INPUT -s 10.0.0.10 -p tcp --dport 5002 -j ACCEPT
```

### 3. Firewall –º–µ–∂–¥—É DMZ –∏ Internal

#### –ü—Ä–∞–≤–∏–ª–∞ –Ω–∞ Internal Firewall

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç Nginx DMZ –∫ Docker —Ö–æ—Å—Ç—É
allow from 10.0.0.10 to 10.0.1.50 port 5000 tcp
allow from 10.0.0.10 to 10.0.1.50 port 5002 tcp

# –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫ –∏–∑ DMZ
deny from 10.0.0.0/24 to 10.0.1.0/24
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env –Ω–∞ Docker —Ö–æ—Å—Ç–µ

```bash
# –ù–∞ Docker —Ö–æ—Å—Ç–µ (10.0.1.50)
nano /opt/faqbot/.env

# –£–∫–∞–∂–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–µ URL (—á–µ—Ä–µ–∑ Nginx –≤ DMZ):
BITRIX24_HANDLER_URL=https://bot.company.com/webhook/bitrix24

# –ò–ª–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞:
# BITRIX24_HANDLER_URL=https://faq.company.com/webhook/bitrix24
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –®–∞–≥ 1: –¢–µ—Å—Ç —Å Docker —Ö–æ—Å—Ç–∞

```bash
# –ù–∞ Docker —Ö–æ—Å—Ç–µ (10.0.1.50)
docker-compose ps  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã

curl http://localhost:5000/health
# –û–∂–∏–¥–∞–µ–º: {"status": "ok"}

curl http://localhost:5002/health
# –û–∂–∏–¥–∞–µ–º: {"status": "ok"}
```

### –®–∞–≥ 2: –¢–µ—Å—Ç —Å Nginx —Å–µ—Ä–≤–µ—Ä–∞ (DMZ)

```bash
# –ù–∞ Nginx —Å–µ—Ä–≤–µ—Ä–µ (10.0.0.10)
curl http://10.0.1.50:5000/health
# –û–∂–∏–¥–∞–µ–º: {"status": "ok"}

curl http://10.0.1.50:5002/health
# –û–∂–∏–¥–∞–µ–º: {"status": "ok"}
```

### –®–∞–≥ 3: –¢–µ—Å—Ç —á–µ—Ä–µ–∑ Nginx (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
# –ù–∞ Nginx —Å–µ—Ä–≤–µ—Ä–µ
curl -H "Host: admin.company.com" http://localhost/health
curl -H "Host: bot.company.com" http://localhost/health
```

### –®–∞–≥ 4: –¢–µ—Å—Ç –∏–∑–≤–Ω–µ

```bash
# –° –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ —Ö–æ—Å—Ç–∞
curl -I https://admin.company.com
# –û–∂–∏–¥–∞–µ–º: HTTP/2 200

curl -I https://bot.company.com/health
# –û–∂–∏–¥–∞–µ–º: HTTP/2 200

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
curl -v https://admin.company.com/health 2>&1 | grep -E '(HTTP|X-Forwarded)'
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ IP

–ù–∞ Nginx –≤ DMZ –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ:

```nginx
# /etc/nginx/sites-available/faqbot
location / {
    # –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –æ—Ñ–∏—Å–Ω—ã—Ö IP –∏–ª–∏ VPN
    allow 203.0.113.0/24;    # –û—Ñ–∏—Å–Ω–∞—è —Å–µ—Ç—å
    allow 198.51.100.0/24;   # VPN —Å–µ—Ç—å
    deny all;

    proxy_pass http://faqbot_admin;
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–µ
}
```

### 2. Basic Authentication

```bash
# –ù–∞ Nginx —Å–µ—Ä–≤–µ—Ä–µ
apt install apache2-utils
htpasswd -c /etc/nginx/.htpasswd admin
# –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å

# –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –¥–æ–±–∞–≤—å—Ç–µ:
# location / {
#     auth_basic "Admin Area";
#     auth_basic_user_file /etc/nginx/.htpasswd;
#     proxy_pass http://faqbot_admin;
# }
```

### 3. Rate Limiting

```nginx
# –í http –±–ª–æ–∫–µ /etc/nginx/nginx.conf
http {
    limit_req_zone $binary_remote_addr zone=faqbot_limit:10m rate=10r/s;

    # –í server –±–ª–æ–∫–µ:
    location / {
        limit_req zone=faqbot_limit burst=20 nodelay;
        proxy_pass http://faqbot_admin;
    }
}
```

### 4. Fail2Ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞

```bash
# –ù–∞ Nginx —Å–µ—Ä–≤–µ—Ä–µ
apt install fail2ban

# /etc/fail2ban/filter.d/nginx-faqbot.conf
[Definition]
failregex = ^<HOST> .* "POST /webhook/bitrix24 HTTP/.*" 40[13]
ignoreregex =

# /etc/fail2ban/jail.d/nginx-faqbot.conf
[nginx-faqbot]
enabled = true
port = http,https
filter = nginx-faqbot
logpath = /var/log/nginx/faqbot-*-access.log
maxretry = 5
bantime = 3600
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –Ω–∞ Nginx —Å–µ—Ä–≤–µ—Ä–µ (DMZ)

```bash
tail -f /var/log/nginx/faqbot-admin-access.log
tail -f /var/log/nginx/faqbot-bitrix-access.log
tail -f /var/log/nginx/error.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
tail -1000 /var/log/nginx/faqbot-admin-access.log | \
  awk '{print $1}' | sort | uniq -c | sort -rn | head -10
```

### –õ–æ–≥–∏ –Ω–∞ Docker —Ö–æ—Å—Ç–µ

```bash
# –ù–∞ Docker —Ö–æ—Å—Ç–µ (10.0.1.50)
docker-compose logs -f web-admin
docker-compose logs -f bitrix24-bot
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏

```bash
# –° Nginx —Å–µ—Ä–≤–µ—Ä–∞
ping 10.0.1.50
traceroute 10.0.1.50
mtr 10.0.1.50

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
nc -zv 10.0.1.50 5000
nc -zv 10.0.1.50 5002
```

## üêõ Troubleshooting

### 502 Bad Gateway

**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ backend —Å–µ—Ä–≤–µ—Ä—É

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Docker —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
ssh user@10.0.1.50 'docker-compose ps'

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –Ω–∞ Docker —Ö–æ—Å—Ç–µ
ssh user@10.0.1.50 'ss -tlnp | grep 5000'

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å Nginx —Å–µ—Ä–≤–µ—Ä–∞
telnet 10.0.1.50 5000

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -50 /var/log/nginx/error.log
ssh user@10.0.1.50 'docker-compose logs --tail=50 web-admin'
```

### 504 Gateway Timeout

**–ü—Ä–∏—á–∏–Ω–∞:** Backend –æ—Ç–≤–µ—á–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ

```bash
# –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
# proxy_connect_timeout 120s;
# proxy_send_timeout 120s;
# proxy_read_timeout 120s;
```

### X-Forwarded-* –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è:
curl -H "Host: admin.company.com" http://10.0.0.10/health -v 2>&1 | grep X-Forwarded

# –í Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
# from flask import request
# print(request.headers.get('X-Forwarded-For'))
# print(request.headers.get('X-Real-IP'))
```

## ‚úÖ Checklist –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä DMZ
- [ ] IP –∞–¥—Ä–µ—Å–∞ –≤ upstream –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ (10.0.1.50)
- [ ] Firewall –º–µ–∂–¥—É DMZ –∏ Internal –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Firewall –Ω–∞ Docker —Ö–æ—Å—Ç–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Å DMZ
- [ ] Docker —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ —Å–ª—É—à–∞—é—Ç 0.0.0.0
- [ ] –¢–µ—Å—Ç —Å Nginx —Å–µ—Ä–≤–µ—Ä–∞ —É—Å–ø–µ—à–µ–Ω (curl)
- [ ] –¢–µ—Å—Ç –∏–∑–≤–Ω–µ —É—Å–ø–µ—à–µ–Ω (curl https://)
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] BITRIX24_HANDLER_URL –≤ .env –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –ø—É–±–ª–∏—á–Ω—ã–º URL
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Å–µ—Ç–µ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–µ—Ç–µ–≤—ã–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º —Å —ç—Ç–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º.
